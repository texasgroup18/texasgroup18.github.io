<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Finance</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .summary {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .summary div {
      font-size: 18px;
      font-weight: bold;
    }
    iframe {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-bottom: 30px;
      background: #fff;
    }
    h2 {
      margin-top: 40px;
      text-align: center;
      color: #444;
    }
  </style>
</head>
<body>

<script>
  const password = "Texas18"; // üîë password set here
  const userPass = prompt("Enter Password to Access Finance Page:");
  if (userPass !== password) {
    document.body.innerHTML = "<h1 style='text-align:center;color:red;'>Access Denied ‚ùå</h1>";
    throw new Error("Access Denied");
  }
</script>

<h1>Finance</h1>

<div class="summary">
  <div>Total Collected: ‚Çπ<span id="totalCollected">-</span></div>
  <div>Total Fines: ‚Çπ<span id="totalFines">-</span></div>
  <div>Total Expenses: ‚Çπ<span id="totalExpenses">-</span></div>
  <div>Remaining: ‚Çπ<span id="remaining">-</span></div>
</div>

<h2>Contributions</h2>
<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vS_rdpztfVyLrlPgSWmNIuGhLeo-g4n9Pw4Zdz0gz92pIXA9eaowq-d-g9GywvK8TlpZ1ET47i8czE8/pubhtml?gid=2096610384&single=true"></iframe>

<h2>Expenses</h2>
<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vS_rdpztfVyLrlPgSWmNIuGhLeo-g4n9Pw4Zdz0gz92pIXA9eaowq-d-g9GywvK8TlpZ1ET47i8czE8/pubhtml?gid=715722052&single=true"></iframe>

<h2>Fines</h2>
<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vS_rdpztfVyLrlPgSWmNIuGhLeo-g4n9Pw4Zdz0gz92pIXA9eaowq-d-g9GywvK8TlpZ1ET47i8czE8/pubhtml?gid=0&single=true"></iframe>

<script>
  // CSV links for calculation
  const contributionCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS_rdpztfVyLrlPgSWmNIuGhLeo-g4n9Pw4Zdz0gz92pIXA9eaowq-d-g9GywvK8TlpZ1ET47i8czE8/pub?gid=2096610384&single=true&output=csv";
  const expenseCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS_rdpztfVyLrlPgSWmNIuGhLeo-g4n9Pw4Zdz0gz92pIXA9eaowq-d-g9GywvK8TlpZ1ET47i8czE8/pub?gid=715722052&single=true&output=csv";
  const fineCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS_rdpztfVyLrlPgSWmNIuGhLeo-g4n9Pw4Zdz0gz92pIXA9eaowq-d-g9GywvK8TlpZ1ET47i8czE8/pub?gid=0&single=true&output=csv";

  async function fetchCSV(url) {
    const res = await fetch(url);
    const text = await res.text();
    return text.split("\n").map(r => r.split(","));
  }

  function sumColumn(data, startRow=1, startCol=1) {
    let sum = 0;
    for (let i = startRow; i < data.length; i++) {
      for (let j = startCol; j < data[i].length; j++) {
        let val = parseFloat(data[i][j]);
        if (!isNaN(val)) sum += val;
      }
    }
    return sum;
  }

  async function updateTotals() {
    try {
      const contribData = await fetchCSV(contributionCSV);
      const expenseData = await fetchCSV(expenseCSV);
      const fineData = await fetchCSV(fineCSV);

      const totalCollected = sumColumn(contribData, 1, 2);
      const totalExpenses = sumColumn(expenseData, 1, 2);
      const totalFines = sumColumn(fineData, 1, 3);

      const remaining = totalCollected + totalFines - totalExpenses;

      document.getElementById("totalCollected").innerText = totalCollected.toFixed(2);
      document.getElementById("totalExpenses").innerText = totalExpenses.toFixed(2);
      document.getElementById("totalFines").innerText = totalFines.toFixed(2);
      document.getElementById("remaining").innerText = remaining.toFixed(2);
    } catch (err) {
      console.error("Error updating totals:", err);
    }
  }

  updateTotals();
</script>

</body>
</html>